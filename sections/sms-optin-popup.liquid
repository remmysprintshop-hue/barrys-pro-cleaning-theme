{% comment %}
  Simple bottom-right popup that appears after delay. Submits to /contact.
{% endcomment %}
<div id="sms-optin" class="sms-optin" hidden>
  <button class="sms-optin__close" aria-label="Close">×</button>
  <h3 class="h4">{{ section.settings.heading | default: "Get cleaning tips & offers" }}</h3>
  <form method="post" action="/contact#ContactFooter" accept-charset="UTF-8">
    <input type="hidden" name="form_type" value="contact">
    <input type="text" name="contact[name]" placeholder="Your name" required>
    <input type="tel" name="contact[phone]" placeholder="Mobile number" required>
    <input type="hidden" name="contact[body]" value="SMS opt-in via popup">
    <button class="button button--primary" style="background:#ff7a00;border-color:#ff7a00">{{ section.settings.button | default: "Subscribe" }}</button>
  </form>
  <p class="sms-optin__fineprint">{{ section.settings.consent | default: "You agree to receive promotional messages from Barry’s Pro Cleaning LLC. You also agree to our Terms of Service and Privacy Policy. Msg frequency varies. Msg and data rates may apply. Reply STOP to end or HELP for Help." }}</p>
</div>

<style>
.sms-optin{ position:fixed; right:16px; bottom:16px; width: 320px; z-index:50; background:#fff; border:1px solid #e5e7eb; border-radius:12px; padding:16px; box-shadow:0 10px 24px rgba(0,0,0,.08); }
.sms-optin input{ width:100%; margin-bottom:8px }
.sms-optin__close{ position:absolute; top:6px; right:8px; background:transparent; border:none; font-size:20px; cursor:pointer }
.sms-optin__fineprint{ font-size:.75rem; color:#6b7280; margin-top:8px }
</style>

<script>
(function(){
  var DELAY = {{ section.settings.delay | default: 5 | times: 1000 }};
  var key = 'sms_optin_closed_v1';
  function show(){ var el = document.getElementById('sms-optin'); if(el){ el.hidden = false; } }
  function hide(){ var el = document.getElementById('sms-optin'); if(el){ el.hidden = true; localStorage.setItem(key, '1'); } }
    setTimeout(show, DELAY);
  }
  document.addEventListener('click', function(e){
    if(e.target && e.target.classList.contains('sms-optin__close')) hide();
  });
})();
</script>

{% schema %}
{
  "name": "SMS opt-in",
  "settings":[
    { "type":"text", "id":"heading", "label":"Heading", "default":"Get cleaning tips & offers" },
    { "type":"text", "id":"button", "label":"Button label", "default":"Subscribe" },
    { "type":"range", "id":"delay", "label":"Delay (seconds)", "min": 1, "max": 20, "step": 1, "default": 5 },
    { "type":"textarea", "id":"consent", "label":"Consent text" }
  ],
  "presets":[ { "name":"SMS opt-in" } ]
}
{% endschema %}
